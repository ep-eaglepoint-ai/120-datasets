{
  "instance_id": "b7d4e1",
  "problem_statement": "Noticed a performance challenge when testing a promo code validation service that requires handling multiple database interactions and concurrent requests at the same time. The task involves an N+1 query situation where fetching usage records individually leads to unnecessary repeated queries, and efficiency becomes critical during flash sales with 2000+ requests per second. Specifically, this issue appeared while working on the validateAndApplyPromoCode function in a MongoDB-based Node.js system, where the goal is to validate promo codes and track usage limits. The system needs to avoid per-validation full collection scans, handle concurrent requests without allowing the same limited-use code to be applied twice, prevent memory from growing unbounded over time, correctly reject expired codes before checking usage counts, and still remain compatible with the existing API contract \u2014 all while ensuring functionality remains identical but response time drops from 800-1200ms to under 100ms by eliminating the N+1 pattern and fixing the race condition.",
  "base_commit": "repository_before",
  "test_patch": "tests/",
  "github_url": "https://github.com/eaglepoint-ai/bd_datasets_002/tree/main/b7d4e1-PromoCode_Service_Performance_Fix",
  "environment_setup": "Dockerfile"
}
